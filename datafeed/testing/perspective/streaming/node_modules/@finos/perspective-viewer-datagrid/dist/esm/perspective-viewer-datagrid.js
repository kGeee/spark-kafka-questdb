import"regular-table";var K='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family,"Material Icons");}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family,"Material Icons");}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) .psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) .psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}regular-table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:"";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:"";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';function Ne(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function W(e,r){let o=Array.from(e.children[0].children[0].children),s=o.length;if(s<=1?o[0]?.removeAttribute("id"):o.forEach((l,i)=>{let a=i===s-2?"psp-column-titles":i===s-1?"psp-column-edit-buttons":null;a?l.setAttribute("id",a):l.removeAttribute("id")}),e.parentElement.parentElement.hasAttribute("settings")){let l=Array.from(o[s-2].children),i=Array.from(o[s-1].children);l&&i&&(o.slice(0,s-2).forEach(n=>{Array.from(n.children).forEach(c=>{c.classList.toggle("psp-menu-open",!1)})}),l.map((n,c)=>[n,i[c]]).forEach(([n,c])=>{let d=n.innerText===r;n.classList.toggle("psp-menu-open",d),c.classList.toggle("psp-menu-open",d)}))}}function Q(e){let r=Array.from(e.children[0].children[0].children);if(r.length>0){W.call(this,e,this._column_settings_selected_column);let[o]=r.splice(this._config.split_by.length,1);X.call(this,e,o,!1);let[s]=r.splice(this._config.split_by.length,1);s&&X.call(this,e,s,!0)}}function X(e,r,o){let s=e._view_cache.config.row_pivots.length-1;for(let t of r?.children){let l=e.getMeta(t),i=l.column_header?.[this._config.split_by.length],a=this._config.sort.find(u=>u[0]===i),n=l.row_header_x===s,c=typeof l.x>"u";n=n||(l.x+1)%this._config.columns.length===0,t.classList.toggle("psp-header-border",n),t.classList.toggle("psp-header-group",!1),t.classList.toggle("psp-header-leaf",!0),t.classList.toggle("psp-is-top",!1),t.classList.toggle("psp-header-corner",c),t.classList.toggle("psp-header-sort-asc",!o&&!!a&&a[1]==="asc"),t.classList.toggle("psp-header-sort-desc",!o&&!!a&&a[1]==="desc"),t.classList.toggle("psp-header-sort-col-asc",!o&&!!a&&a[1]==="col asc"),t.classList.toggle("psp-header-sort-col-desc",!o&&!!a&&a[1]==="col desc");let d=Ne.call(this,l),_=d==="integer"||d==="float",f=d==="string",g=d==="date",p=d==="datetime";t.classList.toggle("psp-align-right",_),t.classList.toggle("psp-align-left",!_),t.classList.toggle("psp-menu-enabled",(f||_||g||p)&&!c&&l.column_header_y==this._config.split_by.length+1),t.classList.toggle("psp-sort-enabled",(f||_||g||p)&&!c&&l.column_header_y===this._config.split_by.length),t.classList.toggle("psp-is-width-override",e._column_sizes?.override[l.size_key]!==void 0)}}function ee(e){let r=e._view_cache.config.row_pivots.length-1,o=Array.from(e.children[0].children[0].children),s=[],t=new Set,l=e.children[0];for(let i=0;i<o.length;i++){let a=l.rows[i],n=new Set;for(let c=0;c<a.cells.length;c++){let d=a.cells[c];d.style.backgroundColor="";let _=e.getMeta(d),f=_.row_header_x===r||_.x>=0;d.classList.toggle("psp-align-right",!1),d.classList.toggle("psp-align-left",!1),d.classList.toggle("psp-header-group",!0),d.classList.toggle("psp-header-leaf",!1),d.classList.toggle("psp-header-border",f),d.classList.toggle("psp-header-group-corner",typeof _.x>"u"),d.classList.toggle("psp-color-mode-bar",!1),d.classList.toggle("psp-header-sort-asc",!1),d.classList.toggle("psp-header-sort-desc",!1),d.classList.toggle("psp-header-sort-col-asc",!1),d.classList.toggle("psp-header-sort-col-desc",!1),d.classList.toggle("psp-sort-enabled",!1);let g=a.cells[c],p=c,u,m;for(;s[i]&&s[i][p];++p);for(n.add(p),u=p;u<p+g.colSpan;++u)for(m=i;m<i+g.rowSpan;++m)s[m]||(s[m]=[]),s[m][u]=!0;g.classList.toggle("psp-is-top",i===0||!t.has(u))}t=n}}var v=Symbol("Plugin Symbol");function te(e,r,[,,,,,o,s],[,,,,,t,l]){let i=this._ids?.[e.dy]?.join("|"),a=e.column_header.join("|");if(this.last_reverse_columns?.has(a)&&this.last_reverse_ids?.has(i)){let n=this.last_reverse_ids?.get(i),c=this.last_reverse_columns.get(a);this._is_old_viewport?this.last_meta?.[c]?.[n]>e.user?(r.style.setProperty("--pulse--background-color-start",t),r.style.setProperty("--pulse--background-color-end",l),r.style.animationName==="pulse_neg"?r.style.animation="pulse_neg2 0.5s linear":r.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[c]?.[n]<e.user?(r.style.setProperty("--pulse--background-color-start",o),r.style.setProperty("--pulse--background-color-end",s),r.style.animationName==="pulse_pos"?r.style.animation="pulse_pos2 0.5s linear":r.style.animation="pulse_pos 0.5s linear"):n!==e.dy&&(r.style.animation=""):r.style.animation=""}else r.style.animation=""}import re from"chroma-js";function q(e,r){return re.mix(e,`rgb(${r[0]},${r[1]},${r[2]})`,.5).hex()}function E([e,r,o,s],t=[255,255,255]){function l(i,a){return((1-s)*(t[i]/255)+s*(a/255))*255}return[l(0,e),l(1,r),l(2,o)]}function S([e,r,o]){return Math.sqrt(e*e*.299+r*r*.587+o*o*.114)>130?"#161616":"#ffffff"}function $e(e){let[r,o,s]=e.rgb(),[t,l,i]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[a,n,c]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${t},${l},${i}),rgb(${r},${o},${s}) 50%,rgb(${a},${n},${c}))`}function w(e){let r=re(e),o=$e(r),s=r.rgb();return[e,...s,o,`rgba(${s[0]},${s[1]},${s[2]},1)`,`rgba(${s[0]},${s[1]},${s[2]},0)`]}function oe(e,r,o){let s=o.user>0,t=o.user<0,l;e?.pos_bg_color!==void 0?l=e.pos_bg_color:l=this._pos_bg_color;let i;e?.neg_bg_color!==void 0?i=e.neg_bg_color:i=this._neg_bg_color;let a=s?l:t?i:["",...this._plugin_background,""];{let[g,p,u,m,x]=a;if(r.style.position="",e?.number_bg_mode==="color")r.style.animation="",r.style.backgroundColor=g;else if(e?.number_bg_mode==="gradient"){let h=Math.max(0,Math.min(1,Math.abs(o.user/e.bg_gradient))),b=this._plugin_background,y=S(E([p,u,m,h],b));r.style.animation="",r.style.color=y,r.style.backgroundColor=`rgba(${p},${u},${m},${h})`}else e?.number_bg_mode==="pulse"?(te.call(this,o,r,l,i),r.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,r.style.animation="",r.style.backgroundColor="")}let[n,c,d,_,f]=(()=>e?.pos_fg_color!==void 0?s?e.pos_fg_color:t?e.neg_fg_color:["",...this._plugin_background,""]:s?this._pos_fg_color:t?this._neg_fg_color:["",...this._plugin_background,""])();if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let g=this._plugin_background,p=S(E([a[1],a[2],a[3],1],g));r.style.color=p}else e?.number_bg_mode==="gradient"||(r.style.color="");else e?.number_fg_mode==="bar"?(r.style.color="",r.style.position="relative",f!==""&&r.children.length>0&&r.children[0].nodeType===Node.ELEMENT_NODE&&(r.children[0].style.background=f)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(r.style.color=n)}import se from"chroma-js";function le(e,r,o){let s=o.column_header?.[this._config.split_by.length],[t,l,i,a,n]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.string_color_mode==="foreground"&&o.user!==null)r.style.color=t,r.style.backgroundColor="",e?.format==="link"&&(r.children[0].style.color=t);else if(e?.string_color_mode==="background"&&o.user!==null){let c=this._plugin_background,d=S(E([l,i,a,1],c));r.style.color=d,r.style.backgroundColor=t}else if(e?.string_color_mode==="series"&&o.user!==null){this._series_color_map.has(s)||(this._series_color_map.set(s,new Map),this._series_color_seed.set(s,0));let c=this._series_color_map.get(s);if(!c.has(o.user)){let k=this._series_color_seed.get(s);c.set(o.user,k),this._series_color_seed.set(s,k+1)}let d=c.get(o.user),[_,f,g]=se(t).hsl();_=_+d*150%360;let p=se(_,f,g,"hsl"),[u,m,x]=p.rgb(),h=p.hex(),b=this._plugin_background,y=S(E([u,m,x,1],b));r.style.color=y,r.style.backgroundColor=h}else r.style.backgroundColor="",r.style.color=""}import"chroma-js";function ie(e,r,o){let s=o.column_header?.[this._config.split_by.length],[t,l,i,a,n]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.datetime_color_mode==="foreground"&&o.user!==null)r.style.color=t,r.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&o.user!==null){let c=this._plugin_background,d=S(E([l,i,a,1],c));r.style.color=d,r.style.backgroundColor=t}else r.style.backgroundColor="",r.style.color=""}function ae(e,r,o){let[s]=o.user===!0?this._pos_fg_color:o.user===!1?this._neg_fg_color:["",0,0,0,""];r.style.backgroundColor="",r.style.color=s}function ne(e,r,o){let s=typeof o.value!=null&&typeof o.value!=null&&o.value?.toString()?.trim().length>0,t=o.row_header_x>=this._config.group_by.length,l=e.getMeta({dx:0,dy:o.y-o.y0+1}),i=l&&l.row_header&&typeof l.row_header[o.row_header_x+1]<"u";r.classList.toggle("psp-tree-label",s&&!t),r.classList.toggle("psp-tree-label-expand",s&&!t&&!i),r.classList.toggle("psp-tree-label-collapse",s&&!t&&i),r.classList.toggle("psp-tree-leaf",s&&t)}function Fe(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function ce(e){let r=e[v]||{};for(let o of e.children[0].children[1].children)for(let s of o.children){let t=e.getMeta(s),l=t.column_header?.[this._config.split_by.length],i=Fe.call(this,t),a=r[l],n=i==="integer"||i==="float";n?oe.call(this,a,s,t):i==="boolean"?ae.call(this,a,s,t):i==="string"?le.call(this,a,s,t):i==="date"||i==="datetime"?ie.call(this,a,s,t):(s.style.backgroundColor="",s.style.color=""),s.classList.toggle("psp-bool-type",i==="boolean"&&t.user!==null);let c=s.tagName==="TH";c&&ne.call(this,e,s,t),s.classList.toggle("psp-align-right",!c&&n),s.classList.toggle("psp-align-left",c||!n),s.classList.toggle("psp-color-mode-bar",a?.number_fg_mode==="bar"&&n)}}async function de(e,r,o){let t=e.getMeta(o).column_header[this._config.split_by.length],i=(r.shiftKey?Te:He).call(this,t);this._preserve_focus_state=!0,await e.parentElement.parentElement.restore({sort:i})}function Te(e){let r=[],o=!1;for(let s of this._config.sort){let[t,l]=s;if(t===e){o=!0;let i=pe.call(this,e,l);i&&r.push(i)}else r.push(s)}return o||r.push([e,"desc"]),r}function He(e){for(let[r,o]of this._config.sort)if(r===e){let s=pe.call(this,e,o);return s?[s]:[]}return[[e,"desc"]]}function pe(e,r){let s=this._config.split_by.length>0?Be:je,t=r?s[r]:"desc";if(t)return[e,t]}var je={desc:"asc",asc:void 0},Be={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function _e(e,r){let o=e.getMeta(r.target),s=r.target.classList.contains("psp-tree-label-collapse");r.shiftKey&&s?this._view.set_depth(o.row_header.filter(t=>t!==void 0).length-2):r.shiftKey?this._view.set_depth(o.row_header.filter(t=>t!==void 0).length-1):s?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function ge(e,r,o){if(o.which!==1)return;let s=o.target;if(s.tagName!=="A"){for(;s.tagName!=="TD"&&s.tagName!=="TH";)if(s=s.parentElement,!e.contains(s))return;if(s.classList.contains("psp-tree-label")){_e.call(this,e,o),o.stopImmediatePropagation();return}if(s.classList.contains("psp-menu-enabled")){let l=e.getMeta(s).column_header?.[this._config.split_by.length];await r.toggleColumnSettings(l),o.preventDefault(),o.stopImmediatePropagation()}else s.classList.contains("psp-sort-enabled")&&(de.call(this,e,o,s),o.stopImmediatePropagation())}}function he(e,r){if(r.which!==1)return;let o=r.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!e.contains(o))return;(o.classList.contains("psp-tree-label")&&r.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&r.stopImmediatePropagation()}function ue(e,r=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,s=e.hasAttribute("selectable"),t=r||!!e.children[0]._is_edit_mode;return o&&!s&&t}function fe(e,r){let o=e[v]||{},s=ue.call(this,r);e.parentElement.classList.toggle("edit-mode-allowed",ue.call(this,r,!0));for(let t of e.querySelectorAll("td")){let l=e.getMeta(t),i=this.get_psp_type(l);if(s&&this._is_editable[l.x]){let a=l.column_header[this._config.split_by.length];i==="string"&&o[a]?.format==="link"?(t.toggleAttribute("contenteditable",!1),t.classList.toggle("boolean-editable",!1)):i==="boolean"?(t.toggleAttribute("contenteditable",!1),t.classList.toggle("boolean-editable",l.user!==null)):(s!==t.hasAttribute("contenteditable")&&t.toggleAttribute("contenteditable",s),t.classList.toggle("boolean-editable",!1))}else t.toggleAttribute("contenteditable",!1),t.classList.toggle("boolean-editable",!1)}}var O=(e,r,o)=>{let s=e.querySelectorAll("td"),t=o.get(e);if(t){for(let l of s){let i=e.getMeta(l);if(i.x===t.x&&i.y===t.y)return document.activeElement!==l&&l.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(document.activeElement)&&document.activeElement.blur()}};function We(e){let r;return async function(...o){if(!!r&&await r&&!!r)return;let s;r=new Promise(t=>s=t),await e.apply(this,o),r=void 0,s()}}function be(){if(this.isContentEditable){let e=document.getSelection().getRangeAt(0),r=e.cloneRange();return r.selectNodeContents(this),r.setEnd(e.endContainer,e.endOffset),r.toString().length}else return this.target.selectionStart}function V(e,r,o){let s=e.getMeta(o),t=r._schema[r._column_paths[s.x]];if(s){let l=o.textContent,i=r._ids[s.y-s.y0];if(t==="float"||t==="integer"){if(l=parseFloat(l.replace(/,/g,"")),isNaN(l))return!1}else if(t==="date"||t==="datetime"){if(l=Date.parse(l),isNaN(l))return!1}else t==="boolean"&&(l=l==="check"?!1:l==="close"?!0:null);let a={__INDEX__:i,[r._column_paths[s.x]]:l};return r._table.update([a],{port_id:r._edit_port}),!0}}function P(e,r=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,s=e.hasAttribute("selectable"),t=r||!!e.children[0]._is_edit_mode;return o&&!s&&t}var C=We(async function(e,r,o,s,t){let l=e.getMeta(o),i=this._column_paths.length,a=this._num_rows,n=r.get(e);if(!n)return;l.x+s<i&&0<=l.x+s&&(n.x=l.x+s),l.y+t<a&&0<=l.y+t&&(n.y=l.y+t);let c=Math.max(l.x0-10,0),d=Math.min(l.x0+10,i),_=Math.max(l.y0-5,0),f=Math.min(l.y0+10,a),g=l.x0+s,p=l.y0+t;for(;!O(e,void 0,r)&&g>=c&&g<d&&p>=_&&p<f;)await e.scrollToCell(g,p,i,a),r.set(e,n),g+=s,p+=t});function me(e,r,o,s){if(!P.call(this,r))return;let t=document.activeElement;switch(s.target.classList.remove("psp-error"),s.keyCode){case 13:s.preventDefault(),s.shiftKey?C.call(this,e,o,t,0,-1):C.call(this,e,o,t,0,1);break;case 37:be.call(t)==0&&(s.preventDefault(),C.call(this,e,o,t,-1,0));break;case 38:s.preventDefault(),C.call(this,e,o,t,0,-1);break;case 39:be.call(t)==t.textContent.length&&(s.preventDefault(),C.call(this,e,o,t,1,0));break;case 40:s.preventDefault(),C.call(this,e,o,t,0,1);break;default:}}function ye(e,r,o){let s=e.getMeta(o.target);if(typeof s?.x<"u"){let t=P.call(this,r),l=this._is_editable[s.x],i=this.get_psp_type(s)==="boolean",a=o.target.textContent==="-";t&&l&&i&&!a&&V(e,this,o.target)}}function xe(e,r,o,s){if(P.call(this,r)&&o.has(e)){s.target.classList.remove("psp-error");let t=o.get(e);o.delete(e),t.content!==s.target.textContent&&(V(e,this,s.target)||(s.target.textContent=t.content,s.target.classList.add("psp-error"),s.target.focus()))}}function ve(e,r,o,s){let t=e.getMeta(s.target);if(t){let l={x:t.x,y:t.y,content:s.target.textContent};o.set(e,l)}}async function z({_view:e,_config:r},o,s){let t=r.group_by,l=r.split_by,i=o>=0?o:0,a=i+1,n=await e.to_json({start_row:i,end_row:a}),d=n.map(x=>x.__ROW_PATH__)[0]||[],_=t.map((x,h)=>{let b=d[h];return b?[x,"==",b]:void 0}).filter(x=>x),f=t.length>0?s+1:s,g=Object.keys(n[0])[f],p={row:n[0]},u=[];if(g){let x=g.split("|");p.column_names=[x[l.length]],u=l.map((h,b)=>{let y=x[b];return y?[h,"==",y]:void 0}).filter(h=>h).filter(([,,h])=>h!=="__ROW_PATH__")}let m=r.filter.concat(_).concat(u);return p.config={filter:m},p}async function we(e,r,o,s){let t=e.getMeta(s.target);if(!r.hasAttribute("selectable")||s.handled||s.which!==1||!t)return;let l=this._ids[t.y-t.y0];if(t&&t.y>=0){let i=o.get(e),a=!!i&&i.reduce((g,p,u)=>g&&p===l[u],!0),n=!!i&&l.length===i.length&&a,c={selected:!n},{row:d,column_names:_,config:f}=await z(this,t.y,t.x);n?(o.delete(e),c={...c,row:d,config:{filter:structuredClone(this._config.filter)}}):(o.set(e,l),c={...c,row:d,column_names:_,config:f}),await e.draw({preserve_width:!0}),s.handled=!0,r.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:c}))}}function ke(e,r,o){if(!r.hasAttribute("selectable"))return;let s=o.has(e),t=o.get(e);for(let l of e.querySelectorAll("td"))if(!s)l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let i=e.getMeta(l),a=this._ids[i.y-i.y0],n=t.reduce((c,d,_)=>c&&d===a[_],!0);l.classList.toggle("psp-row-selected",a.length===t.length&&n),l.classList.toggle("psp-row-subselected",a.length!==t.length&&n)}for(let l of e.querySelectorAll("tbody th")){let i=e.getMeta(l),a=this._ids[i.y-i.y0];if(!s||!!a[i.row_header_x])l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let n=t.reduce((c,d,_)=>c&&d===a[_],!0);l.classList.toggle("psp-row-selected",a.length===t.length&&n),l.classList.toggle("psp-row-subselected",a.length!==t.length&&n)}}}async function Le(e,r,o){o.delete(e);for(let s of e.querySelectorAll("td,th"))s.classList.toggle("psp-row-selected",!1),s.classList.toggle("psp-row-subselected",!1)}import Ve from"chroma-js";import{get_type_config as R}from"@finos/perspective/src/js/config/index.js";var Ee={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},D=class{constructor(){this._formatters=new Map}create_datetime_formatter(r,o){let s=R(r);if(r==="datetime")if(o.format!=="custom"){let t={...s.format,timeZone:o.timeZone,dateStyle:o.dateStyle,timeStyle:o.timeStyle};return t.dateStyle==="disabled"?t.dateStyle=void 0:t.dateStyle===void 0&&(t.dateStyle=s.format.dateStyle),t.timeStyle==="disabled"?t.timeStyle=void 0:t.timeStyle===void 0&&(t.timeStyle=s.format.timeStyle),new Intl.DateTimeFormat([],t)}else{let t={timeZone:o.timeZone,second:o.second,minute:o.minute,hour:o.hour,day:o.day,weekday:o.weekday,month:o.month,year:o.year,hour12:o.hour12,fractionalSecondDigits:o.fractionalSecondDigits};return t.year==="disabled"?t.year=void 0:t.year===void 0&&(t.year="2-digit"),t.month==="disabled"?t.month=void 0:t.month===void 0&&(t.month="numeric"),t.day==="disabled"?t.day=void 0:t.day===void 0&&(t.day="numeric"),t.weekday==="disabled"&&(t.weekday=void 0),t.hour==="disabled"?t.hour=void 0:t.hour===void 0&&(t.hour="numeric"),t.minute==="disabled"?t.minute=void 0:t.minute===void 0&&(t.minute="numeric"),t.second==="disabled"?t.second=void 0:t.second===void 0&&(t.second="numeric"),t.hour12===void 0&&(t.hour12=!0),new Intl.DateTimeFormat([],t)}else{let t={...s.format,dateStyle:o.dateStyle};return t.dateStyle==="disabled"?t.dateStyle=void 0:t.dateStyle===void 0&&(t.dateStyle=s.format.dateStyle),new Intl.DateTimeFormat([],t)}}create_number_formatter(r,o){let{format:s}=R(r);return o.fixed!==void 0&&(s.minimumFractionDigits=o.fixed,s.maximumFractionDigits=o.fixed),new Ee[r]([],s)}create_boolean_formatter(r,o){let s=R(r);return new Ee[r]([],s.format)}get(r,o){let s=[r,o.fixed,o.timeZone,o.dateStyle,o.timeStyle,o.fractionalSecondDigits,o.format,o.year,o.month,o.day,o.weekday,o.hour,o.minute,o.second,o.hour12].join("-");if(!this._formatters.has(s)){let t=R(r);r==="date"||r==="datetime"?this._formatters.set(s,this.create_datetime_formatter(r,o)):r==="integer"||r==="float"?this._formatters.set(s,this.create_number_formatter(r,o)):r==="boolean"?this._formatters.set(s,this.create_boolean_formatter(r,o)):this._formatters.set(s,!1)}return this._formatters.get(s)}};var qe=new D;function I(e,r,o={},s=!1){if(r===null)return"-";let t=s&&this._table_schema[e]||this._schema[e]||"string",l=o[e]||{};if((t==="integer"||t==="float")&&l?.number_fg_mode==="bar"){let a=Math.max(0,Math.min(.95,Math.abs(r/l.fg_gradient)*.95)),n=this._div_factory.get(),c=r>=0?"left":"right";return n.setAttribute("style",`width:${(a*100).toFixed(2)}%;position:absolute;${c}:0;height:80%;top:10%;pointer-events:none;`),n}else if(l?.format==="link"&&t==="string"){let a=document.createElement("a");return a.setAttribute("href",r),a.setAttribute("target","_blank"),a.textContent=r,a}else if(l?.format==="bold"&&t==="string"){let a=document.createElement("b");return a.textContent=r,a}else if(l?.format==="italics"&&t==="string"){let a=document.createElement("i");return a.textContent=r,a}else{let a=qe.get(t,l);return a?a.format(r):r}}function*Se(e=[],r,o){let s=o[v];for(let t of e){t=["TOTAL",...t];let l=t[t.length-1];t=t.slice(0,t.length-1).fill("");let i=I.call(this,r[t.length-1],l,s,!0);i instanceof HTMLElement?t=t.concat(i):t=t.concat({toString:()=>i}),t.length=r.length+1,yield t}}function Ce(){let e,r,o,s,t;return async function(i,a,n,c,d){let _={},f;c-a>0&&d-n>0?(this._is_old_viewport=this._last_window?.start_row===n&&this._last_window?.end_row===d&&this._last_window?.start_col===a&&this._last_window?.end_col===c,f={start_row:n,start_col:a,end_row:d,end_col:c,id:!0},_=JSON.parse(await this._view.to_columns_string(f)),this._last_window=f,this._ids=_.__ID__,this._reverse_columns=this._column_paths.slice(a,c).reduce((h,b,y)=>(h.set(b,y),h),new Map),this._reverse_ids=this._ids.reduce((h,b,y)=>(h.set(b?.join("|"),y),h),new Map)):this._div_factory.clear();let g=[],p=[],u=[],m=[],x=i.parentElement.parentElement.hasAttribute("settings");for(let h=a;h<Math.min(c,this._column_paths.length);++h){let b=this._column_paths[h],y=b.split("|"),k=_[b]||new Array(d-n).fill(null);g.push(k.map(M=>I.call(this,y[this._config.split_by.length],M,i[v]))),p.push(k),x&&y.push("Edit"),u.push(y),m.push(b)}return c-a>0&&d-n>0&&(this.last_column_paths=r,this.last_meta=e,this.last_ids=o,this.last_reverse_ids=s,this.last_reverse_columns=t,r=m,e=p,o=this._ids,s=this._reverse_ids,t=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(Se.call(this,_.__ROW_PATH__,this._config.group_by,i)),column_headers:u,data:g,metadata:p,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function N(e,r,o){let s=window.getComputedStyle(e).getPropertyValue(r).trim();return s.length>0?s:o}var Y=class{constructor(r){this._name=r,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let r=this._elements[this._index];return this._index+=1,r}};function Ye(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function G(e,r,o,s={}){let t=await o.get_config(),l=t.expressions.map(L=>L[1]),[i,a,n,c,d,_,f]=await Promise.all([r.schema(),r.validate_expressions(l),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths(),this.parentElement.getEditPort()]),g=Ve(N(e,"--plugin--background","#FFFFFF")).rgb(),p=w(N(e,"--rt-pos-cell--color","#338DCD")),u=w(N(e,"--rt-neg-cell--color","#FF5942")),m=w(q(p[0],g)),x=w(q(u[0],g)),h=w(N(e,"--active--color","#ff0000")),b={...c,...d},y={...i,...a.expression_schema},k=_.filter(L=>L!=="__ROW_PATH__"&&L!=="__ID__"),M=[],J=[];for(let L of k){let Z=L.split("|")[t.split_by.length];J.push(b[Z]),M.push(!!i[Z])}let A=Object.assign(s,{_edit_port:f,_view:o,_table:r,_table_schema:y,_config:t,_num_rows:n,_schema:b,_ids:[],_plugin_background:g,_color:h,_pos_fg_color:p,_neg_fg_color:u,_pos_bg_color:m,_neg_bg_color:x,_column_paths:k,_column_types:J,_is_editable:M,_row_header_types:t.group_by.map(L=>y[L]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Ye});return A._div_factory=A._div_factory||new Y("div"),e.setDataListener(Ce().bind(A,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),A}async function ze(e,r,o){let s=e.getMeta(o.target);if(!s)return;let{x:t,y:l}=s,{row:i,column_names:a,config:n}=await z(this,l,t);r.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:i,column_names:a,config:n}}))}async function Me(e){let r=this.parentElement,o=await r.getTable(!0);if(this._initialized)await G.call(this,this.regular_table,o,e,this.model);else{this.innerHTML="",this.appendChild(this.regular_table),this.model=await G.call(this,this.regular_table,o,e),this.regular_table.addStyleListener(ce.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(ee.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Q.bind(this.model,this.regular_table)),this.regular_table.addEventListener("click",he.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",ge.bind(this.model,this.regular_table,r));let s=new WeakMap;this.regular_table.addStyleListener(ke.bind(this.model,this.regular_table,r,s)),this.regular_table.addEventListener("mousedown",we.bind(this.model,this.regular_table,r,s)),this.regular_table.addEventListener("psp-deselect-all",Le.bind(this.model,this.regular_table,r,s)),this.regular_table.addEventListener("click",ze.bind(this.model,this.regular_table,r));let t=new WeakMap;this.regular_table.addStyleListener(fe.bind(this.model,this.regular_table,r)),this.regular_table.addStyleListener(O.bind(this.model,this.regular_table,r,t)),this.regular_table.addEventListener("click",ye.bind(this.model,this.regular_table,r)),this.regular_table.addEventListener("focusin",ve.bind(this.model,this.regular_table,r,t)),this.regular_table.addEventListener("focusout",xe.bind(this.model,this.regular_table,r,t)),this.regular_table.addEventListener("keydown",me.bind(this.model,this.regular_table,r,t)),r.addEventListener("perspective-toggle-column-settings",l=>{if(this.isConnected){if(W(this.regular_table,l.detail.column_name),!l.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=l.detail.column_name}}),this._initialized=!0}}function $(e,r=!1){if(!this._initialized)return;r&&(this._cached_column_sizes=e);let o={},{group_by:s,columns:t}=this.model._config,l=s?.length>0?s.length+1:0;for(let i of Object.keys(e))if(i==="__ROW_PATH__")o[l-1]=e[i];else{let a=this.model._column_paths.indexOf(i);o[a+l]=e[i]}this.regular_table._column_sizes.override=o}function F(){if(!this._initialized)return[];if(this._cached_column_sizes){let l=this._cached_column_sizes;return this._cached_column_sizes=void 0,l}let e=this.regular_table._column_sizes.override,{group_by:r,columns:o}=this.model._config,s=r?.length>0?r.length+1:0,t={};for(let l of Object.keys(e))if(e[l]!==void 0){let i=l-s;i>-1?t[this.model._column_paths[i]]=e[l]:i===-1&&(t.__ROW_PATH__=e[l])}return t}function T(e=void 0){typeof e>"u"&&(e=!this._is_edit_mode),this._is_edit_mode=e,this.classList.toggle("editable",e),this._edit_mode!==void 0&&(this._edit_mode.classList.toggle("editable",e),e?this._edit_mode.children[0].textContent="Editable":this._edit_mode.children[0].textContent="Read Only")}function H(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&(this._scroll_lock.classList.toggle("lock-scroll",e),e?this._scroll_lock.children[0].textContent="Align Scroll":this._scroll_lock.children[0].textContent="Free Scroll")}function Ae(e){e=JSON.parse(JSON.stringify(e));let r={};if(e.columns)for(let s of Object.keys(e.columns)){let t=e.columns[s];t.column_size_override!==void 0&&(r[s]=t.column_size_override,delete t.column_size_override),t?.pos_fg_color&&(t.pos_fg_color=w(t.pos_fg_color),t.neg_fg_color=w(t.neg_fg_color)),t?.pos_bg_color&&(t.pos_bg_color=w(t.pos_bg_color),t.neg_bg_color=w(t.neg_bg_color)),t?.color&&(t.color=w(t.color)),Object.keys(t).length===0&&delete e.columns[s]}"editable"in e&&T.call(this,e.editable),"scroll_lock"in e&&H.call(this,e.scroll_lock);let o=this.regular_table;$.call(this,r,!0),o[v]=e.columns}function Oe(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar")),this.parentElement.appendChild(this._toolbar)}function Pe(){if(this.regular_table){let e=this.regular_table,r={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode};for(let s of Object.keys(e[v]||{})){let t=Object.assign({},e[v][s]);(t?.pos_fg_color||t?.pos_bg_color)&&(t.pos_fg_color=t.pos_fg_color?.[0],t.neg_fg_color=t.neg_fg_color?.[0],t.pos_bg_color=t.pos_bg_color?.[0],t.neg_bg_color=t.neg_bg_color?.[0]),t?.color&&(t.color=t.color[0]),r.columns[s]=t}let o=F.call(this);for(let s of Object.keys(o||{}))r.columns[s]||(r.columns[s]={}),r.columns[s].column_size_override=o[s];return JSON.parse(JSON.stringify(r))}return{}}async function Re(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null)return;let r=F.call(this),o=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),$.call(this,r),await o,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function U(){let e=o=>{let s;return o==="integer"||o==="float"?s={fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled",fixed:o==="float"?2:0}:s={color:this.model._color[0],bg_color:this.model._color[0]},s},r={};for(let o of["string","float","integer","bool","date","datetime"])r[o]=e(o);return r}var j=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this._is_scroll_lock=!1}connectedCallback(){return Oe.call(this)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(r){return await Me.call(this,r)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}get plugin_attributes(){return{style:U.call(this)}}async draw(r){return await Re.call(this,r)}async update(r){this.model._num_rows=await r.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return Pe.call(this)}restore(r){return Ae.call(this,r)}async restyle(r){await this.draw(r)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}};var De=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:var(--toolbar-edit-mode--content);}#edit_mode.editable:before{-webkit-mask-image:var(--toolbar-edit-mode-active--content);}:host(.aggregated) #toolbar #edit_mode{display:none;}.button:before{width:25px;height:21px;content:"";-webkit-mask-image:cover;mask-image:cover;background-color:var(--icon--color,#ccc);margin:0 5px;}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;align-items:center;user-select:none;width:37px;height:22px;box-sizing:border-box;white-space:nowrap;border:1px solid transparent;border-radius:3px;}.button>span{display:none;margin:0;padding:0;}.button:hover{background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;min-width:var(--button--min-width,105px);}.button:hover:before{background-color:var(--plugin--background);margin:0 5px 0 5px;}.button:hover>span{display:contents;font-size:9px;line-height:36px;}';var B=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${De}
            </style>
            <div id="toolbar">
                <span id="scroll_lock" class="button">
                    <span>Free Scroll</span>
                </span>
                <span id="edit_mode" class="button"><span>Read Only</span></span>
            </div>
        `;let r=this.parentElement,o=r.querySelector("perspective-viewer-datagrid");o._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),o._scroll_lock.addEventListener("click",()=>H.call(o)),o._edit_mode=this.shadowRoot.querySelector("#edit_mode"),o._edit_mode.addEventListener("click",()=>{T.call(o),o.regular_table.draw(),r.dispatchEvent(new Event("perspective-config-update"))})}};function Ue(){let e=document.createElement("style");e.textContent=K,document.head.insertBefore(e,document.head.firstChild)}async function Je(){customElements.define("perspective-viewer-datagrid-toolbar",B),customElements.define("perspective-viewer-datagrid",j),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}Je();Ue();
//# sourceMappingURL=perspective-viewer-datagrid.js.map
